---
title: "Delivery Mode and the Meconium Microbiome"
name: "Shaimaa Elsafoury"
date: "2/24/2022"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{The Endometriosis-associated Microbiome}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


# Analysis objectives

1. Import, recode, and subset data from bugsigdb.org    
2. Create a table of studies
3. Calculate the frequency of appearance of each taxa in independent signatures and identify the most frequently reported taxa

# Making sure packages are installed

```{r, eval=FALSE, messages=FALSE}
install.packages(c("devtools", "tidyverse", "kableExtra"))
devtools::install_github("waldronlab/bugSigSimple")
devtools::install_github("waldronlab/BugSigDBStats")
devtools::install_github("waldronlab/bugsigdbr")
```

# Load and subset data

```{r, messages=FALSE}
library(bugSigSimple)
library(BugSigDBStats)
library(bugsigdbr)
library(tidyverse)
library(stringr)
library(kableExtra)
library(dplyr)
```

```{r}
# use version="devel" and cache = FALSE to take the latest version from bugsigdb.org
dat <- bugsigdbr::importBugSigDB(version = "devel", cache = TRUE) 
dim(dat)
names(dat)
```

# Subsetting

Subsetting only studies on meconium 

```{r, messages=FALSE}

subset.dat <-
  dat[which(
    dat$PMID == "28018325" |
      dat$PMID == "24614698" |
      dat$PMID == "29207565" |
      dat$PMID == "29459704" |
      dat$PMID == "29538354" |
      dat$PMID == "32012716" |
      dat$PMID == "20566857" |
      dat$PMID == "28512451" |
      dat$PMID == "28112736" |
      dat$PMID == "27362264"
  ),]
```

subset.dat2 <-
  subset.dat[which(
    subset.dat$`Group 0 name` == "vaginal delivery"|
      subset.dat$`Group 0 name` == "vaginally born controls"|
      subset.dat$`Group 0 name` == "vaginal delivery in mecomium"|
      subset.dat$`Group 0 name` == "	vaginally born controls"),]



subset.dat3 <-
  subset.dat2[which(
    subset.dat2$`Body site` == "meconium" 
  ),]
  

# All studies

Summary of studies and most frequent taxa increased and decreased in endometriosis patients for all studies

```{r, messages=FALSE}
bugSigSimple::createStudyTable(subset.dat3)
```

```{r}
getMostFrequentTaxa(subset.dat3,n=50)
```

```{r}
getMostFrequentTaxa(subset.dat3,sig.type="increased")
```

```{r}
getMostFrequentTaxa(subset.dat3,sig.type="decreased")
```
